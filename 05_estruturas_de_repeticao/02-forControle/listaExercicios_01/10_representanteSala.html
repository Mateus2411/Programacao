<meta charset="UTF-8" />
<script>
  //ENTRADA
  let quantidadeDeCandidatos;
  do {
    quantidadeDeCandidatos = Number(prompt(`Qual a quantidade de candidatos`));
  } while (isNaN(quantidadeDeCandidatos) || quantidadeDeCandidatos <= 0);

  // Nome dos candidatos
  let candidatos = [{ nome: "null", votos: 0, numero: 0 }];

  let numeroCandidato = 0;
  for (let a = 0; a < quantidadeDeCandidatos; a++) {
    let nomeCandidato;
    do {
      nomeCandidato = prompt(
        `Qual o nome do ${numeroCandidato + 1}° candidato?`
      );
    } while (!nomeCandidato || nomeCandidato.trim() === "");

    // Capitaliza a primeira letra e deixa o resto minúsculo
    nomeCandidato =
      nomeCandidato.charAt(0).toUpperCase() +
      nomeCandidato.slice(1).toLowerCase();

    numeroCandidato++;
    candidatos.push({
      nome: nomeCandidato,
      votos: 0,
      numero: numeroCandidato,
    });
  }

  // Quantidade de alunos votantes
  let quantidadeDeAlunosVotantes;
  do {
    quantidadeDeAlunosVotantes = Number(prompt(`Quantos alunos votantes?`));
  } while (
    isNaN(quantidadeDeAlunosVotantes) ||
    quantidadeDeAlunosVotantes <= 0
  );

  // Votação
  let listaCandidatos = "";
  for (let i = 0; i < candidatos.length; i++) {
    if (candidatos[i].nome !== "null") {
      listaCandidatos += `${i} - ${candidatos[i].nome}\n`;
    }
  }

  for (
    let repeticoes = 0;
    repeticoes < quantidadeDeAlunosVotantes;
    repeticoes++
  ) {
    let votarCandidato = Number(
      prompt(`Em quem gostaria de votar?\nCandidatos\n${listaCandidatos}`)
    );
    if (
      candidatos[votarCandidato] &&
      candidatos[votarCandidato].nome !== "null"
    ) {
      candidatos[votarCandidato].votos++;
    } else {
      alert("Voto inválido");
      repeticoes--;
    }
  }

  // FUNÇÃO DE SAÍDA
  function mostrarResultado(candidatos, totalVotos) {
    candidatos.sort((a, b) => b.votos - a.votos);
    let resultado = "Resultado da votação:\n";

    // Calcula porcentagens e monta resultado
    candidatos.forEach((c) => {
      if (c.nome !== "null") {
        let porcentagem = ((c.votos / totalVotos) * 100).toFixed(2);
        resultado += `${c.nome}: ${c.votos} votos (${porcentagem}%)\n`;
      }
    });

    // Checa empate
    let topVotos = candidatos[1] ? candidatos[1].votos : 0;
    if (candidatos[0].votos !== topVotos) {
      let porcentagemVencedor = (
        (candidatos[0].votos / totalVotos) *
        100
      ).toFixed(2);
      resultado += `\nO vencedor é o candidato ${candidatos[0].nome} com ${porcentagemVencedor}% dos votos.`;
    } else {
      let empatados = candidatos.filter(
        (c) => c.votos === candidatos[0].votos && c.nome !== "null"
      );
      resultado += `\nO resultado deu empate entre:\n`;
      empatados.forEach((c) => {
        let porcentagem = ((c.votos / totalVotos) * 100).toFixed(2);
        resultado += `${c.nome} ${porcentagem}%\n`;
      });
    }

    alert(resultado);
  }

  // Chama a função de saída
  mostrarResultado(candidatos, quantidadeDeAlunosVotantes);
</script>